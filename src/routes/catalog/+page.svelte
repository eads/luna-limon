<script lang="ts">
	import type { Product } from '$lib/server/catalog';
	import { cart } from '$lib/cart';
	export let data: { products: Product[] };
	console.log(data);
	let added = new Set<string>();
	function handleAdd(product: Product) {
		cart.add(product);
		added.add(product.id);
		added = new Set(added);
		setTimeout(() => {
			added.delete(product.id);
			added = new Set(added);
		}, 800);
	}
</script>

<h1 class="text-2xl font-bold mb-4">Catalog</h1>
<ul class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
	{#each data.products as product (product.id)}
		<li class="border rounded shadow p-4 flex flex-col gap-2 bg-white">
			<h2 class="font-semibold text-lg">{product.nombre}</h2>
			<p class="text-sm text-gray-700">{product.descripci√≥n}</p>
			<p class="font-medium">${product.precio}</p>
			<button
				class="mt-auto rounded bg-blue-600 text-white py-1 px-2 text-sm"
				on:click={() => handleAdd(product)}
			>
				{#if added.has(product.id)}
					Added!
				{:else}
					Add
				{/if}
			</button>
		</li>
	{/each}
</ul>
<a href="/cart" class="block mt-6 text-blue-600 underline">Go to cart</a>
